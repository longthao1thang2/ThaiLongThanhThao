<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long üíñ Th·∫£o - H√†nh Tr√¨nh K·∫πo Ng·ªçt</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Itim & Quicksand -->
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Quicksand:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK (S·ª≠ d·ª•ng phi√™n b·∫£n t∆∞∆°ng th√≠ch) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root {
            --pink-main: #ff5c8a;
            --pink-light: #ff8fa3;
            --pink-bg: #fff0f3;
            --text-dark: #641220;
            --white-glass: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--pink-bg);
            color: var(--text-dark);
            overflow-x: hidden;
            scroll-behavior: smooth;
            cursor: pointer;
        }

        .font-cute { font-family: 'Itim', cursive; }

        .bg-magic {
            background-color: var(--pink-bg);
            background-image: 
                radial-gradient(#ffb3c6 2px, transparent 2px),
                linear-gradient(180deg, #fff0f3 0%, #ffe5ec 100%);
            background-size: 30px 30px, 100% 100%;
            background-attachment: fixed;
        }

        /* ----- M√ÇY TR√îI (N·ªÄN) ----- */
        .clouds-container {
            position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
        }
        .cloud {
            position: absolute; background: rgba(255, 255, 255, 0.7); border-radius: 200px;
            filter: blur(5px); animation: floatCloud linear infinite;
        }
        .cloud::before, .cloud::after {
            content: ''; position: absolute; background: rgba(255, 255, 255, 0.7); border-radius: 50%;
        }
        .cloud-1 { top: 15%; width: 120px; height: 40px; animation-duration: 35s; left: -150px; }
        .cloud-1::before { width: 50px; height: 50px; top: -20px; left: 15px; }
        .cloud-1::after { width: 40px; height: 40px; top: -15px; right: 20px; }
        
        .cloud-2 { top: 50%; width: 180px; height: 50px; animation-duration: 50s; left: -250px; opacity: 0.6;}
        .cloud-2::before { width: 70px; height: 70px; top: -30px; left: 25px; }
        .cloud-2::after { width: 50px; height: 50px; top: -15px; right: 25px; }

        @keyframes floatCloud {
            from { transform: translateX(0); }
            to { transform: translateX(120vw); }
        }

        /* ----- HI·ªÜU ·ª®NG T∆Ø∆†NG T√ÅC CHU·ªòT ----- */
        .sparkle-trail {
            position: absolute; pointer-events: none; z-index: 9999;
            animation: fallAndFade 0.8s forwards cubic-bezier(0.1, 1, 0.3, 1);
            font-size: 14px;
        }
        @keyframes fallAndFade {
            0% { transform: scale(1) translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(0) translateY(30px) rotate(90deg); opacity: 0; }
        }

        .click-burst {
            position: absolute; pointer-events: none; z-index: 10000;
            transform: translate(-50%, -50%);
            animation: burstPop 0.8s forwards ease-out;
            font-size: 20px;
        }
        @keyframes burstPop {
            0% { transform: translate(-50%, -50%) scale(0.2); opacity: 1; }
            50% { transform: translate(-50%, -100%) scale(1.2); opacity: 0.8; }
            100% { transform: translate(-50%, -150%) scale(1.5); opacity: 0; }
        }

        /* ----- KH·ªêI GIAO DI·ªÜN ----- */
        .kawaii-card {
            background: var(--white-glass);
            backdrop-filter: blur(12px); border-radius: 35px; border: 3px solid #fff;
            box-shadow: 0 15px 35px rgba(255, 92, 138, 0.12), inset 0 -4px 0 rgba(255, 255, 255, 0.9);
            transition: transform 0.3s ease;
        }

        .btn-jelly {
            background: linear-gradient(135deg, var(--pink-main), var(--pink-light));
            color: white; border-radius: 999px; font-weight: 800;
            border: 3px solid white;
            box-shadow: 0 6px 0 #ff3366, 0 10px 15px rgba(255, 92, 138, 0.3);
            transition: all 0.1s; cursor: pointer; display: inline-flex; align-items: center; justify-content: center;
        }
        .btn-jelly:active {
            transform: translateY(6px);
            box-shadow: 0 0px 0 #ff3366, 0 4px 8px rgba(255, 92, 138, 0.2);
        }

        .input-cute {
            width: 100%; background: #fff; border: 3px solid #ffe5ec; border-radius: 20px; padding: 16px 20px;
            font-weight: 700; color: var(--pink-main); text-align: center;
            transition: all 0.3s; outline: none; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        .input-cute:focus {
            border-color: var(--pink-light); box-shadow: 0 0 0 4px rgba(255, 143, 163, 0.15);
        }
        .input-cute::placeholder { color: #ffb3c6; font-weight: 600; font-family: 'Quicksand', sans-serif;}

        /* Widget ƒê·ªìng H·ªì (Reponsive) */
        .timer-widget {
            background: white; border-radius: 24px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(255, 92, 138, 0.1); border: 3px solid #fff;
            position: relative; overflow: hidden;
            aspect-ratio: 1 / 1; 
        }
        .timer-widget::after {
            content: ''; position: absolute; top: 6px; right: 6px;
            width: 12px; height: 12px; background: rgba(255,255,255,0.9); border-radius: 50%;
        }

        /* ----- ƒêƒ®A THAN NH·∫†C ----- */
        .vinyl-player {
            position: fixed; bottom: 20px; left: 20px; z-index: 100;
            width: 55px; height: 55px; border-radius: 50%;
            background: #222; border: 3px solid #fff;
            box-shadow: 0 4px 12px rgba(255, 92, 138, 0.3);
            display: flex; align-items: center; justify-content: center;
            animation: spinVinyl 3s linear infinite; cursor: pointer;
            transition: transform 0.2s;
        }
        .vinyl-player:hover { transform: scale(1.1); }
        .vinyl-player::before {
            content: ''; position: absolute; width: 16px; height: 16px;
            background: var(--pink-main); border-radius: 50%; border: 2px solid #fff;
        }
        .vinyl-player::after {
            content: 'üéµ'; position: absolute; top: -12px; right: -12px; font-size: 18px;
            animation: floatNote 2s infinite alternate;
        }
        .vinyl-player.paused { animation-play-state: paused; }
        .vinyl-player.paused::after { display: none; }
        @keyframes spinVinyl { 100% { transform: rotate(360deg); } }
        @keyframes floatNote { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-10px) rotate(15deg); opacity: 0; } }

        /* ----- ·∫¢NH POLAROID ----- */
        .scrapbook-img {
            background: white; padding: 10px 10px 35px 10px;
            border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.05);
            position: relative; transition: all 0.4s ease;
            break-inside: avoid; margin-bottom: 24px; border: 1px solid #fdfdfd;
        }
        .scrapbook-img:hover {
            transform: scale(1.05) rotate(0deg) !important; z-index: 20; box-shadow: 0 15px 30px rgba(255, 92, 138, 0.2);
        }
        .img-container {
            width: 100%; border-radius: 8px; overflow: hidden; background: #ffe5ec;
        }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        
        .washi-tape {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%) rotate(-2deg);
            width: 80px; height: 24px; background-color: #ffccd5;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255,255,255,0.6) 4px, rgba(255,255,255,0.6) 8px);
            opacity: 0.95; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 2;
        }

        /* ----- TH√îNG B√ÅO (TOAST) ----- */
        #cute-toast {
            position: fixed; bottom: -120px; left: 50%; transform: translateX(-50%);
            background: white; padding: 12px 24px; border-radius: 999px;
            box-shadow: 0 8px 25px rgba(255, 92, 138, 0.25); border: 3px solid #ffb3c6;
            display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 1rem; color: var(--pink-main);
            transition: bottom 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); z-index: 9999;
            width: max-content; max-width: 90vw;
        }
        #cute-toast.show-toast { bottom: 30px; }

        .heart-beat { animation: heartbeat 1.2s infinite; display: inline-block; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 15%, 45% { transform: scale(1.2); } 30% { transform: scale(1); } }
        
        .hidden-section { display: none !important; }

        .sticker-badge {
            background: #ff5c8a; color: white; padding: 6px 20px; border-radius: 999px;
            font-family: 'Itim', cursive; font-size: 1.2rem;
            display: inline-flex; align-items: center; gap: 6px;
            box-shadow: 0 4px 12px rgba(255, 92, 138, 0.3); border: 2px dashed rgba(255,255,255,0.8);
            transform: rotate(-2deg);
        }
    </style>
</head>
<body class="bg-magic">

    <!-- AUDIO NH·∫†C N·ªÄN -->
    <!-- S·ª≠ d·ª•ng b·∫£n nh·∫°c piano l√£ng m·∫°n mi·ªÖn ph√≠ b·∫£n quy·ªÅn -->
    <audio id="bg-music" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-romantic-piano-136.mp3" type="audio/mpeg">
    </audio>

    <!-- B·∫¶U TR·ªúI M√ÇY TR√îI -->
    <div class="clouds-container">
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
    </div>
    <div id="cursor-effects-container"></div>

    <!-- ƒêƒ®A THAN ƒêI·ªÄU KHI·ªÇN NH·∫†C (M·∫∑c ƒë·ªãnh pause) -->
    <div id="vinyl-btn" class="vinyl-player paused hidden-section" title="B·∫≠t/T·∫Øt Nh·∫°c T√¨nh Y√™u"></div>

    <!-- TH√îNG B√ÅO -->
    <div id="cute-toast">
        <span class="text-xl" id="toast-icon">ü™Ñ</span> <span id="toast-msg">Th√¥ng b√°o</span>
    </div>

    <!-- ================= 1. TRANG ƒêƒÇNG NH·∫¨P ================= -->
    <div id="login-section" class="min-h-screen flex items-center justify-center p-4 relative z-50">
        <div class="kawaii-card p-8 sm:p-12 w-full max-w-[400px] text-center relative overflow-hidden">
            <div class="absolute -top-10 -right-10 w-24 h-24 bg-yellow-100 rounded-full mix-blend-multiply filter blur-xl opacity-70"></div>
            
            <div class="text-[4rem] sm:text-[5rem] mb-2 heart-beat drop-shadow-md">üíå</div>
            
            <h1 class="font-cute text-4xl sm:text-5xl text-[#ff5c8a] mb-2 leading-tight">
                V∆∞∆°ng Qu·ªëc <br> C·ªßa T·ª•i M√¨nh
            </h1>
            <p class="font-bold text-[#ff8fa3] mb-8 text-sm sm:text-base">Nh·∫≠p ƒë√∫ng m·∫≠t m√£ ƒë·ªÉ v√†o nha üçì</p>

            <div class="space-y-4 sm:space-y-5">
                <div>
                    <input type="text" id="username" class="input-cute text-lg" placeholder="T√™n ƒë√¥i m√¨nh" autocomplete="off">
                </div>
                <div>
                    <input type="password" id="password" class="input-cute text-lg" placeholder="M·∫≠t m√£" autocomplete="off">
                </div>
                
                <div id="login-error" class="text-red-500 text-sm hidden font-bold">
                    Hong ƒë√∫ng r·ªìi, nh·∫≠p l·∫°i ƒëi n√®! ü•∫
                </div>
                
                <button onclick="handleLogin()" class="btn-jelly w-full py-3 sm:py-4 text-lg mt-2">
                    M·ªü Kh√≥a Tr√°i Tim ‚ú®
                </button>
            </div>
        </div>
    </div>

    <!-- ================= 2. M√ÄN H√åNH CH·ªú ================= -->
    <div id="loading-section" class="hidden-section min-h-screen flex flex-col items-center justify-center relative z-50 p-4 text-center">
        <div class="text-[5rem] sm:text-[6rem] heart-beat mb-4 drop-shadow-[0_0_20px_rgba(255,92,138,0.4)]">ü™Ñ</div>
        <h2 class="font-cute text-4xl sm:text-5xl text-[#ff5c8a] mb-2">ƒêang h√≥a ph√©p...</h2>
        <div class="flex gap-2 mt-4 justify-center">
            <div class="w-3 h-3 rounded-full bg-[#ff5c8a] animate-bounce"></div>
            <div class="w-3 h-3 rounded-full bg-[#ff8fa3] animate-bounce" style="animation-delay: 0.1s;"></div>
            <div class="w-3 h-3 rounded-full bg-[#ffb3c6] animate-bounce" style="animation-delay: 0.2s;"></div>
        </div>
    </div>

    <!-- ================= 3. TRANG CH√çNH ================= -->
    <div id="main-section" class="hidden-section relative z-10">
        
        <div id="uploading-overlay" class="hidden-section fixed inset-0 bg-white/80 backdrop-blur-md z-[9998] flex flex-col items-center justify-center p-4 text-center">
            <div class="text-6xl mb-4 heart-beat">‚òÅÔ∏è</div>
            <h3 class="font-cute text-3xl text-[#ff5c8a]">ƒêang c·∫•t ·∫£nh l√™n m√¢y...</h3>
        </div>

        <!-- PH·∫¶N HEADER -->
        <section class="min-h-[90vh] flex flex-col items-center justify-center text-center p-4 pt-8">
            <div class="kawaii-card p-6 sm:p-10 md:p-14 max-w-3xl w-full mx-auto relative">
                <div class="absolute -top-4 -left-4 text-4xl transform -rotate-12 animate-bounce">‚≠ê</div>
                
                <h1 class="font-cute text-[2.8rem] sm:text-6xl md:text-7xl text-[#641220] mb-4">
                    H·ªì Th√°i Long
                </h1>
                
                <div class="my-4">
                    <span class="sticker-badge text-sm sm:text-lg">
                        ‚ú® ƒêang b√°m nhau v·ªõi ‚ú®
                    </span>
                </div>

                <h1 class="font-cute text-[2.8rem] sm:text-6xl md:text-7xl text-[#641220] mt-4 mb-6">
                    ƒêo√†n Th·ªã Thanh Th·∫£o
                </h1>
                
                <div class="bg-white/70 p-4 sm:p-6 rounded-2xl border border-dashed border-[#ffb3c6] max-w-xl mx-auto">
                    <p class="font-semibold text-base sm:text-xl text-[#ff5c8a] leading-relaxed">
                        "Tr√°i ƒë·∫•t c√≥ h∆°n 8 t·ª∑ ng∆∞·ªùi, nh∆∞ng Long ch·ªâ mu·ªën b√°m l·∫•y m·ªói m√¨nh Th·∫£o th√¥i. K·ªÉ t·ª´ ng√†y 01/02/2026, th·∫ø gi·ªõi n√†y t·ª± nhi√™n l·∫°i r·ª±c r·ª° ƒë·∫øn l·∫°! üçì"
                    </p>
                </div>
                
                <div class="mt-8">
                    <button onclick="document.getElementById('timer-section').scrollIntoView()" class="btn-jelly px-6 sm:px-8 py-3 text-base sm:text-lg">
                        Xem T·ª•i M√¨nh ƒê√£ Quen Bao L√¢u üëá
                    </button>
                </div>
            </div>
        </section>

        <!-- PH·∫¶N ƒê·∫æM TH·ªúI GIAN -->
        <section id="timer-section" class="py-16 sm:py-20 flex flex-col items-center justify-center px-4 w-full">
            <h2 class="font-cute text-4xl sm:text-5xl text-[#ff5c8a] mb-8 text-center drop-shadow-sm">
                ƒê√£ b√°m nhau ƒë∆∞·ª£c... üß∏
            </h2>
            
            <div class="grid grid-cols-2 md:flex md:flex-row justify-center gap-4 sm:gap-6 w-full max-w-[600px] z-10 px-2">
                <div class="timer-widget w-full md:w-28 md:h-32">
                    <span id="days" class="font-cute text-[2.5rem] sm:text-5xl text-[#ff5c8a] leading-none z-10">0</span>
                    <span class="text-[10px] sm:text-xs font-bold text-[#ff8fa3] mt-2 z-10 uppercase tracking-widest">Ng√†y</span>
                </div>
                <div class="timer-widget w-full md:w-28 md:h-32">
                    <span id="hours" class="font-cute text-[2.5rem] sm:text-5xl text-[#ff5c8a] leading-none z-10">0</span>
                    <span class="text-[10px] sm:text-xs font-bold text-[#ff8fa3] mt-2 z-10 uppercase tracking-widest">Gi·ªù</span>
                </div>
                <div class="timer-widget w-full md:w-28 md:h-32">
                    <span id="minutes" class="font-cute text-[2.5rem] sm:text-5xl text-[#ff5c8a] leading-none z-10">0</span>
                    <span class="text-[10px] sm:text-xs font-bold text-[#ff8fa3] mt-2 z-10 uppercase tracking-widest">Ph√∫t</span>
                </div>
                <div class="timer-widget w-full md:w-28 md:h-32">
                    <span id="seconds" class="font-cute text-[2.5rem] sm:text-5xl text-[#ff5c8a] leading-none z-10">0</span>
                    <span class="text-[10px] sm:text-xs font-bold text-[#ff8fa3] mt-2 z-10 uppercase tracking-widest">Gi√¢y</span>
                </div>
            </div>
            
            <div class="mt-10 kawaii-card px-6 py-3 inline-block transform -rotate-1">
                <p class="font-bold text-[#641220] text-sm sm:text-lg text-center">
                    C·ªôt m·ªëc ƒë√°ng nh·ªõ: <span class="text-[#ff5c8a] font-cute text-lg sm:text-xl ml-1">01.02.2026</span> üçí
                </p>
            </div>
        </section>

        <!-- PH√íNG TRANH NH·∫¨T K√ù (CLOUD) -->
        <section class="py-16 sm:py-20 flex flex-col items-center relative w-full px-4">
            <div class="kawaii-card p-6 sm:p-10 max-w-4xl w-full text-center mb-8 border-dashed">
                <h2 class="font-cute text-3xl sm:text-[3.5rem] text-[#ff5c8a] mb-2 sm:mb-4">G√≥c S·ªëng ·∫¢o üì∏</h2>
                <p class="font-bold text-[#ff8fa3] mb-6 text-sm sm:text-lg">·∫¢nh t·∫£i l√™n ƒë√¢y s·∫Ω ƒë∆∞·ª£c l∆∞u tr√™n Cloud cho m·ªçi ng∆∞·ªùi c√πng xem nh√©!</p>
                
                <label for="photo-upload" class="cursor-pointer inline-flex items-center justify-center gap-2 btn-jelly py-3 px-6 sm:px-8 text-base sm:text-xl w-full sm:w-auto">
                    <span class="text-2xl">‚òÅÔ∏è</span> 
                    <span>T·∫£i ·∫¢nh L√™n Cloud M√¢y</span>
                </label>
                <input type="file" id="photo-upload" class="hidden" accept="image/*">
            </div>
            
            <div id="polaroid-gallery" class="columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-6 max-w-[1200px] w-full">
                <!-- N·ªôi dung ·∫£nh Cloud s·∫Ω ƒë·ªï v√†o ƒë√¢y -->
                <div id="empty-state" class="col-span-full text-center py-12">
                    <div class="text-[4rem] sm:text-[5rem] mb-2 animate-bounce">‚òÅÔ∏è</div>
                    <p class="font-cute text-2xl sm:text-3xl text-[#ff8fa3]">ƒê√°m m√¢y k·ª∑ ni·ªám ƒëang tr·ªëng r·ªóng, √∫p ·∫£nh ƒëi nha!</p>
                </div>
            </div>
        </section>

        <!-- L·ªúI H·ª®A C·ª¶A LONG -->
        <section class="py-16 sm:py-20 flex flex-col items-center justify-center p-4 mb-10 w-full">
            <div class="bg-[#fffdf9] p-6 sm:p-10 md:p-14 max-w-2xl w-full relative rounded-3xl shadow-lg border-[6px] sm:border-[10px] border-white outline outline-2 sm:outline-4 outline-[#ffb3c6]">
                <h2 class="font-cute text-4xl sm:text-[3rem] text-[#ff5c8a] mb-6 font-normal text-center">B·ª©c Th∆∞ T√¨nh üìù</h2>
                
                <div class="font-semibold text-base sm:text-xl text-[#641220] text-justify space-y-4 sm:space-y-6 leading-relaxed">
                    <p>G·ª≠i b√© Th·∫£o ƒë√°ng y√™u nh·∫•t qu·∫£ ƒë·∫•t c·ªßa anh,</p>
                    <p>Ng∆∞·ªùi ta n√≥i b·∫Øt ƒë·∫ßu m·ªôt m·ªëi quan h·ªá th√¨ d·ªÖ, nh∆∞ng gi·ªØ ƒë∆∞·ª£c nhau m·ªõi kh√≥. Nh∆∞ng t·ª´ c√°i ng√†y 01/02/2026 ·∫•y, anh ƒë√£ bi·∫øt m√¨nh ch·∫≥ng mu·ªën ƒëi ƒë√¢u t√¨m ki·∫øm n·ªØa, v√¨ anh ƒë√£ "b√°m" tr√∫ng b·∫øn ƒë·ªó b√¨nh y√™n nh·∫•t r·ªìi üçì.</p>
                    <p>Anh h·ª©a s·∫Ω lu√¥n nh∆∞·ªùng nh·ªãn em (d√π ƒë√¥i khi em h∆°i ngang b∆∞·ªõng), s·∫Ω lu√¥n n·∫Øm tay em qua nh·ªØng con ƒë∆∞·ªùng ƒë√¥ng ƒë√∫c, v√† s·∫Ω mua ƒë·ªì ƒÉn ngon cho em m·ªói khi em d·ªói üßã.</p>
                    <p>C·∫£m ∆°n Th·∫£o v√¨ ƒë√£ cho Long c∆° h·ªôi ƒë∆∞·ª£c b∆∞·ªõc v√†o cu·ªôc s·ªëng c·ªßa em. H√£y ƒë·ªÉ anh ti·∫øp t·ª•c "b√°m" l·∫•y em kh√¥ng ch·ªâ b√¢y gi·ªù, m√† l√† r·∫•t, r·∫•t l√¢u v·ªÅ sau n·ªØa nh√©! üíñ</p>
                </div>
                
                <div class="mt-8 sm:mt-10 text-right pr-2 pt-6 border-t border-dashed border-[#ffe5ec]">
                    <p class="font-bold text-[#ff8fa3] text-[10px] sm:text-xs mb-1 uppercase tracking-widest">Ng∆∞·ªùi t·ª± nguy·ªán b·ªã b√°m</p>
                    <p class="font-cute text-[2.5rem] sm:text-[3rem] text-[#ff5c8a] transform -rotate-3 mt-1">H·ªì Th√°i Long</p>
                </div>
            </div>
        </section>

        <footer class="text-center py-8 text-[#ff8fa3] font-bold text-sm sm:text-base border-t border-white/40">
            <p>X√¢y d·ª±ng b·∫±ng 100% t√¨nh y√™u v√† ph√©p thu·∫≠t ‚ú®</p>
        </footer>
    </div>

    <script>
        // ================= BI·∫æN TO√ÄN C·ª§C & √ÇM NH·∫†C =================
        const bgMusic = document.getElementById('bg-music');
        const vinylBtn = document.getElementById('vinyl-btn');
        let toastTimeout; 

        // H√†m b·∫≠t nh·∫°c
        function playMusic() {
            bgMusic.play().then(() => {
                vinylBtn.classList.remove('paused');
            }).catch(e => {
                console.log("Tr√¨nh duy·ªát ch·∫∑n t·ª± ph√°t nh·∫°c, ng∆∞·ªùi d√πng c·∫ßn b·∫•m v√†o ƒëƒ©a than.");
            });
        }

        // B·∫≠t t·∫Øt nh·∫°c b·∫±ng ƒëƒ©a than
        vinylBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play();
                vinylBtn.classList.remove('paused');
                showToast("ƒê√£ b·∫≠t nh·∫°c t√¨nh y√™u", "üéµ");
            } else {
                bgMusic.pause();
                vinylBtn.classList.add('paused');
                showToast("ƒê√£ t·∫Øt nh·∫°c", "ü§´");
            }
        });

        const showToast = (message, icon = "ü™Ñ") => {
            const toast = document.getElementById('cute-toast');
            document.getElementById('toast-msg').innerText = message;
            document.getElementById('toast-icon').innerText = icon;
            toast.classList.add('show-toast');
            if(toastTimeout) clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => { toast.classList.remove('show-toast'); }, 3000); 
        };

        // ================= HI·ªÜU ·ª®NG T∆Ø∆†NG T√ÅC =================
        const cursorContainer = document.getElementById('cursor-effects-container');
        document.addEventListener('mousemove', function(e) {
            if (Date.now() - window.lastSparkTime > 60) { 
                const spark = document.createElement('div');
                spark.className = 'sparkle-trail';
                spark.innerText = ['‚ú®', '‚≠ê', 'üíñ', 'ü´ß'][Math.floor(Math.random() * 4)];
                spark.style.left = (e.pageX - 10) + 'px'; spark.style.top = (e.pageY - 10) + 'px';
                cursorContainer.appendChild(spark);
                setTimeout(() => spark.remove(), 800);
                window.lastSparkTime = Date.now();
            }
        });

        document.body.addEventListener('click', function(e) {
            if(e.target.tagName === 'INPUT' || e.target.closest('label') || e.target.closest('button') || e.target.id === 'vinyl-btn') return;
            for(let i=0; i<4; i++) {
                const particle = document.createElement('div');
                particle.className = 'click-burst';
                particle.innerText = ['‚ù§Ô∏è', 'üçì', 'üéÄ'][Math.floor(Math.random()*3)];
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 40 + 10;
                particle.style.left = (e.pageX + Math.cos(angle)*distance) + 'px';
                particle.style.top = (e.pageY + Math.sin(angle)*distance) + 'px';
                particle.style.animationDuration = (0.5 + Math.random() * 0.4) + 's';
                cursorContainer.appendChild(particle);
                setTimeout(() => particle.remove(), 900);
            }
        });

        // ================= THI·∫æT L·∫¨P FIREBASE CLOUD (TU√ÇN TH·ª¶ NGHI√äM NG·∫∂T RULE) =================
        // S·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng h·ªá th·ªëng cung c·∫•p
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'long-thao-magic-app';
        let db, auth;

        // B∆Ø·ªöC 1: Kh·ªüi t·∫°o Firebase ·ªü ngo√†i c√πng
        if (firebaseConfig && !firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        if(firebase.apps.length) {
            auth = firebase.auth();
            db = firebase.firestore();
        }

        // B∆Ø·ªöC 2: X√°c th·ª±c (Auth) - B·∫Øt bu·ªôc ch·∫°y tr∆∞·ªõc khi truy v·∫•n Data
        const initAuthAndFetchData = async () => {
            if (!auth || !db) return; // Tr√°nh l·ªói n·∫øu kh√¥ng c√≥ m·∫°ng
            
            try {
                // ƒêƒÉng nh·∫≠p b·∫±ng token h·ªá th·ªëng ho·∫∑c ·∫©n danh
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await auth.signInWithCustomToken(__initial_auth_token);
                } else {
                    await auth.signInAnonymously();
                }

                // Thi·∫øt l·∫≠p l·∫Øng nghe tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
                auth.onAuthStateChanged((user) => {
                    // B∆Ø·ªöC 3: C√≥ User r·ªìi m·ªõi b·∫Øt ƒë·∫ßu g·ªçi d·ªØ li·ªáu (Rule 3)
                    if (user) {
                        listenToCloudPhotos();
                    }
                });
            } catch (error) {
                console.error("L·ªói x√°c th·ª±c Firebase:", error);
            }
        };

        // ================= APP LOGIC (ƒêƒÇNG NH·∫¨P & CLOUD) =================
        window.handleLogin = function() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const errorMsg = document.getElementById('login-error');

            if (user === 'longthao' && pass === '1thang2') {
                errorMsg.classList.add('hidden');
                document.getElementById('login-section').classList.add('hidden-section');
                document.getElementById('loading-section').classList.remove('hidden-section');

                // B·∫Øt ƒë·∫ßu quy tr√¨nh k·∫øt n·ªëi ƒê√°m M√¢y khi user ·∫•n ƒêƒÉng Nh·∫≠p
                initAuthAndFetchData(); 

                setTimeout(() => {
                    document.getElementById('loading-section').classList.add('hidden-section');
                    document.getElementById('main-section').classList.remove('hidden-section');
                    document.getElementById('vinyl-btn').classList.remove('hidden-section'); // Hi·ªán ƒëƒ©a than
                    
                    startTimer(); 
                    playMusic(); // K√≠ch ho·∫°t ph√°t nh·∫°c khi chuy·ªÉn trang
                    showToast("Ch√†o m·ª´ng Long & Th·∫£o v·ªÅ nh√†", "ü•∞");
                }, 2000);
            } else {
                errorMsg.classList.remove('hidden');
                const card = document.querySelector('.kawaii-card');
                card.style.transform = 'scale(1) translateX(-10px)';
                setTimeout(() => card.style.transform = 'scale(1) translateX(10px)', 100);
                setTimeout(() => card.style.transform = 'scale(1) translateY(0)', 200);
            }
        }

        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleLogin();
        });

        // ƒê·∫øm gi·ªù
        function startTimer() {
            const startDate = new Date(2026, 1, 1, 0, 0, 0).getTime(); 
            setInterval(() => {
                const difference = new Date().getTime() - startDate;
                if (difference < 0) {
                    document.getElementById('days').innerText = "0"; document.getElementById('hours').innerText = "00";
                    document.getElementById('minutes').innerText = "00"; document.getElementById('seconds').innerText = "00";
                    return; 
                }
                document.getElementById('days').innerText = Math.floor(difference / (1000 * 60 * 60 * 24));
                document.getElementById('hours').innerText = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                document.getElementById('minutes').innerText = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                document.getElementById('seconds').innerText = Math.floor((difference % (1000 * 60)) / 1000).toString().padStart(2, '0');
            }, 1000);
        }

        // L·∫•y d·ªØ li·ªáu t·ª´ Cloud (Rule 1 & Rule 2)
        function listenToCloudPhotos() {
            // Path chu·∫©n b·∫Øt bu·ªôc cho Public Data
            const collectionPath = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('photos');
            
            // Query ƒë∆°n gi·∫£n, KH√îNG d√πng orderBy ·ªü ƒë√¢y ƒë·ªÉ tr√°nh l·ªói Index
            collectionPath.onSnapshot(snapshot => {
                const gallery = document.getElementById('polaroid-gallery');
                let photos = [];
                
                snapshot.forEach(doc => {
                    photos.push({ id: doc.id, ...doc.data() });
                });
                
                // S·∫Øp x·∫øp d·ªØ li·ªáu b·∫±ng Javascript (Rule 2)
                photos.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

                if (photos.length === 0) return;

                gallery.innerHTML = ''; // X√≥a ch·ªØ tr·ªëng
                photos.forEach(photo => renderCutePhoto(photo.base64, photo.caption, gallery));
            }, error => {
                console.error("L·ªói k√©o ·∫£nh t·ª´ Cloud:", error);
            });
        }

        function renderCutePhoto(imgSrc, caption, container) {
            const emptyState = document.getElementById('empty-state');
            if(emptyState) emptyState.remove();

            const div = document.createElement('div');
            const randomRotation = (Math.random() * 4 - 2).toFixed(1); 
            
            div.className = `scrapbook-img`;
            div.style.transform = `rotate(${randomRotation}deg)`;
            div.innerHTML = `
                <div class="washi-tape"></div>
                <div class="img-container">
                    <img src="${imgSrc}" alt="K·ª∑ ni·ªám Long Th·∫£o" loading="lazy">
                </div>
                <div class="mt-4 text-center">
                    <p class="font-cute text-2xl sm:text-3xl text-[#ff5c8a]">${caption}</p>
                </div>
            `;
            container.appendChild(div);
        }

        // T·∫£i ·∫£nh l√™n Cloud
        const uploadInput = document.getElementById('photo-upload');
        const cuteCaptions = ["Kho·∫£nh kh·∫Øc c∆∞ng x·ªâu üíï", "Hai ƒë·ª©a m√¨nh n√® üçì", "Y√™u Th·∫£o nh·∫•t ‚ú®", "B√°m nhau m√£i nh√© ü´Ç", "Xinh g√°i qu√° ch·ª´ng üå∏", "ƒê√°ng iu gh√™ üòç"];

        uploadInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file || !file.type.startsWith('image/')) return;

            document.getElementById('uploading-overlay').classList.remove('hidden-section');

            try {
                const base64Data = await compressImage(file);
                const randomCaption = cuteCaptions[Math.floor(Math.random() * cuteCaptions.length)];
                
                // Ki·ªÉm tra n·∫øu ƒë√£ x√°c th·ª±c v·ªõi Cloud
                if (auth && auth.currentUser && db) {
                    const collectionPath = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('photos');
                    
                    // Th√™m d·ªØ li·ªáu l√™n Cloud
                    await collectionPath.add({
                        base64: base64Data,
                        caption: randomCaption,
                        timestamp: Date.now()
                    });
                    showToast("ƒê√£ l∆∞u ·∫£nh l√™n ƒê√°m M√¢y", "‚òÅÔ∏è");
                } else {
                    // Fallback n·∫øu web ch·∫°y offline
                    const gallery = document.getElementById('polaroid-gallery');
                    renderCutePhoto(base64Data, randomCaption, gallery);
                    showToast("ƒê√£ th√™m ·∫£nh (Ch·∫ø ƒë·ªô xem tr∆∞·ªõc)", "üì∏");
                }
            } catch (error) {
                console.error("L·ªói t·∫£i ·∫£nh:", error);
                showToast("L·ªói r√πi, th·ª≠ l·∫°i nha b√©", "ü•∫");
            } finally {
                document.getElementById('uploading-overlay').classList.add('hidden-section');
                uploadInput.value = '';
            }
        });

        // N√©n ·∫£nh tr∆∞·ªõc khi up l√™n Cloud (Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc Database)
        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = event => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_SIZE = 600; 
                        let width = img.width, height = img.height;

                        if (width > height && width > MAX_SIZE) {
                            height *= MAX_SIZE / width; width = MAX_SIZE;
                        } else if (height > MAX_SIZE) {
                            width *= MAX_SIZE / height; height = MAX_SIZE;
                        }

                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }
    </script>
</body>
</html>


